Guia del laboratorio

Consideraciones:
_35GB de almacenamiento disponible para vmware, si quedas con poco espacio puedes ver este tutorial https://www.youtube.com/watch?v=NwpzYlfKnrY
_2-4GB de ram para la utilización del laboratorio

Pasos para correr el laboratorio:

_Instalar una máquina virtual con vmware con la iso de Kali Linux 
-VMWARE -> https://www.vmware.com/cl/products/workstation-player/workstation-player-evaluation.html
-ISO KALI LINUX -> https://www.kali.org/get-kali/

_Una vez instalada la distro en la maquina virtual correrla y proceder a ejecutar el siguiente comando en una terminal
-	->   git clone https://github.com/nlavanderos/pentest_usach
-	->  el siguiente paso es hacer cd a la carpeta de pentest_usach
_ En el directorio antes de ejecutar el script de lab.sh
-	Deberás darle permisos al script, para evitar el uso de sudo -> chmod +x ./lab.sh     
-	Correr el script para verificar dependencias -> ./lab.sh -C
-	Bajar las dependencias en este caso las asociadas a Docker,pip3,Docker compose y yq
-	sudo apt install docker.io  
-	sudo apt install docker-compose
-	sudo apt install python3-pip
-	sudo pip3 install yq
En caso de algún error al ejecutar por ejemplo docker deberás siempre dar permisos chmod, para docker seria 
sudo chmod 666 /var/run/docker.sock

_Para ver los commandos que puedes ejecutar en el laboratorio deberás ejecutar
./lab.sh –help

    Control local pentest lab.

  -h | --help                Print this usage.
  -i | --info                Print generall information.
  -o | --overview TEXT       Print overview table of services. [default: all]
                                Options: red_team
                                TEXT is a space separated list like: 'red_team '.
  -B | --build               Build the lab and not start it.
  -u | --up                  Start pentest lab if not allready running.
  -d | --down                Stop pentest lab if not allready stopped.
  -R | --remove              Remove files like SSH keys from local dir.
  -p | --prune               Prune pentest lab after stopping.
                                This will delete images, networks, containers and volumes.
                                All data stored in persistent volumes will be lost.
  -C | --check-dependencies  Check for all mandatory dependencies.
  -A | --all-services        Set lab to run all available services.


Para corer el lab debes hacer un up como primer paso.
./lab.sh -u

Nota: si un servicio requiere algún tipo de instalación en el primer uso, use 
docker inspect (nombre_imagen)
 para averiguar dónde la imagen de docker almacena los datos y agregue un volumen que apunte a este directorio. En el ejemplo anterior esto es:

Esto garantiza que no tenga que volver a configurar el servicio cada vez que reinicie el laboratorio. Pero si desea restablecer el laboratorio y comenzar de nuevo por completo, puede usar
 ./lab.sh -p | --prune  
Esto eliminará todos los recursos propiedad del laboratorio.


Rangos de IP
La razón por la que usamos direcciones IP estáticas es que la caja de Kali necesita tener una dirección IP que no cambie para simplificar el inicio de sesión SSH. Más información en la sección Consejos/Trucos a continuación.
Los servicios para las víctimas(victim) comienzan en 10.5.0.100
Los servicios del red team comienzan en 10.5.0.5
El servicio Kali tiene 10.5.0.5.


Información del lab
./lab.sh --overview all  


Para entrar a la maquina
ssh root@10.5.0.5 -o "UserKnownHostsFile /dev/null" 
